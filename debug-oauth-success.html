<!DOCTYPE html>
<html>
<head>
    <title>Debug OAuth Success</title>
</head>
<body>
    <h1>OAuth Debug Page</h1>
    <div id="debug-info"></div>
    
    <script>
        function debugOAuth() {
            const debugInfo = document.getElementById('debug-info');
            
            // Get current URL
            const currentUrl = window.location.href;
            
            // Get hash fragment
            const hash = window.location.hash;
            
            // Get query parameters
            const search = window.location.search;
            
            // Parse hash fragment
            const hashParams = new URLSearchParams(hash.substring(1));
            const hashTokens = {
                access_token: hashParams.get('access_token'),
                refresh_token: hashParams.get('refresh_token'),
                expires_in: hashParams.get('expires_in'),
                token_type: hashParams.get('token_type')
            };
            
            // Parse query parameters
            const searchParams = new URLSearchParams(search);
            const queryTokens = {
                access_token: searchParams.get('access_token'),
                refresh_token: searchParams.get('refresh_token'),
                expires_in: searchParams.get('expires_in'),
                token_type: searchParams.get('token_type')
            };
            
            debugInfo.innerHTML = `
                <h2>URL Debug Info</h2>
                <p><strong>Full URL:</strong> ${currentUrl}</p>
                <p><strong>Hash:</strong> ${hash}</p>
                <p><strong>Search:</strong> ${search}</p>
                
                <h3>Hash Fragment Tokens:</h3>
                <pre>${JSON.stringify(hashTokens, null, 2)}</pre>
                
                <h3>Query Parameter Tokens:</h3>
                <pre>${JSON.stringify(queryTokens, null, 2)}</pre>
                
                <h3>Test Protocol Callback:</h3>
                <button onclick="testProtocol()">Test eloquent:// protocol</button>
            `;
        }
        
        function testProtocol() {
            const testUrl = 'eloquent://auth/success?access_token=debug_test_token&refresh_token=debug_refresh_token';
            console.log('Testing protocol:', testUrl);
            try {
                window.location.href = testUrl;
                alert('Protocol test sent - check Electron app console');
            } catch (error) {
                alert('Protocol test failed: ' + error.message);
            }
        }
        
        // Run debug on page load
        debugOAuth();
    </script>
</body>
</html>